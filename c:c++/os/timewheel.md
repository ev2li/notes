# 时间轮

## __linux内核的5级时间轮:__

- 简介 : linux内核中的多级时间轮算法采用5级日间轮.每级时间轮的粒度分别为1ms,256ms,25664ms,2566464ms,256646464ms,它们每级时间轮tick刻度数量分别为256(低8bits),64(次6bit),64(次6bits).64(高6bits) 以32bits为一个单位(ms)

- 处理过程:	
	- 步骤1:对于32bit以毫秒为单位的时间t,tick取t的低8bits,如果tick不为0执行步骤6,如果tick是0,执行步骤2
	- 步骤2:tick取t的次6bits,如果tick不为0.取出2级时间轮该tick的双向循环链表,然后遍历该链表的定时器,根据到期时间来判断将定时器插入到1级还是2级时间轮,执行步骤6,如果tick为0执行步骤3
	- 步骤3:ick取t的次6bits,如果tick不为0.取出3级时间轮该tick的双向循环链表,然后遍历该链表的定时器,根据到期时间来判断将定时器插入到1级还是2级还是3级时间轮,执行步骤6,如果tick为0执行步骤4
	- 步骤4:ick取t的次6bits,如果tick不为0.取出4级时间轮该tick的双向循环链表,然后遍历该链表的定时器,根据到期时间来判断将定时器插入到1级还是2级还是3级还是4级时间轮,执行步骤6,如果tick为0执行步骤5
	- 步骤5:ick取t的次6bits,如果tick不为0.取出5级时间轮该tick的双向循环链表,然后遍历该链表的定时器,根据到期时间来判断将定时器插入到1级,2级,,3级,4级,5级时间轮,执行步骤6
	- 步骤6:遍历1级时间轮中该tick的双向循环链表,执行这些到期定时器的回调函数
	
- 特点:
	- 可添加大量定时器
	- 支持从系统启动到2^32ms的时间
	- 时间精度为毫秒
	- 可添加One-shot Timer(一次性定时器),也可添加Repeating Timer(带有首次触发时间和再次触发时间间隔的计时器)
	- 采用多级时间轮算法,节省内存
	- 定时器增删执行时间复杂度为O(1)
	- 时间轮的运行需要1个线程
	- 使用select进行计时,而不是sigaction(SIGALRM,,) + settimer (ITIMER_REAL, , );
	
## __关于monotonic时间:__
monotonic它表示从系统启动这一刻到现在的时长,不受系统时间被用户修改的影响



