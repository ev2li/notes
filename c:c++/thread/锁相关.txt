一:自旋锁:
    自旋锁不会引用调用者睡眠,如果自旋锁已经被别的执行单元保持,调用者就一直循环在那里是否该自旋锁的保持都已经释放了锁,由于自旋锁使用者一般保持时间非常短,因此选择自旋而不是睡眠非常重要,自旋锁的效率远高于互斥锁

二:内核态和用户态:
    1.内核态:在内核空间执行,通常是驱动程序,中断相关程序,内核调度程序,内存管理及其操作
    2.用户态:用户程序执行
进程上下文和中断上下文:
    进程上下文:
        1.进程上文:其是指进程由用户态切换到内核态时需要保存用户态时cpu寄存器中的值,进程状态以及堆栈上的内容,即保存当前进程的进程上下文,以便再次执行该进程时,能够恢复切换时的状态,继续执行
        2.进程下文:其是指切换到内核态后执行的程序,即进程运行在内核空间的部分
    中断上下文:
        1.中断上文:硬件通过中断触发信号,导致内核调用中断处理程序,进入内核空间,这个过程中,硬件的一些变量和参数也要传递给内核,内核通过这些参数进行中断处理,中断上文可以看作就是硬件传递过来的这些参数和内核需要保存的一些其他环境(主要是当前被中断的进程环境)
        2.中断下文:执行在内核空间的中断服务程序
    为什么要进行不同状态之间的切换:
        当工作在用户态的进程想访问某些内核态才能访问的资源时,必须通过系统调用者或者中断切换到内核态,由内核代替其执行,进程上下文和中断上下文就是完成这两种状态切换所进程的操作总称,我将其理解为保存用户空间状态的是上文,切换后在内核态执行的程序是下文
    中断上下文代码中注意事项:
运行于进程上下文的内核代码是可抢占的,但中断上下文则会一直运行到结束,不能被抢占,所以处理中断程序代码要受到一些限制,在中断代码中不能出现实现下面功能的代码:
    1.睡眠或者放弃CPU
        因为内核在进入中断之前会关闭进程调度,一旦睡眠或者放弃CPU,这时内核无法调度别的进程来执行,系统就会死掉(中断程序一定不能睡眠或者阻塞)
    2.尝试获取信号量:
        如果获取不到信号量,代码就会睡眠
    3.执行耗时的任务:
        中断处理应该尽可能的快,因为如果一个处理程序是IRQF_DISABLED类型,他执行时会禁止本地中断线,而内核要响应大量服务和请求,中断上下文占用CPU时间太长会严重影响系统功能,中断处理程序的任务尽可能放在中断下半部执行
    4.访问用户空间的虚拟地址
        因为中断运行在内核空间
三:中断:
    中断是指当出现需要时,CPU暂时停止当前程序的执行处理新情况的程序和执行过程,即在程序运行过程中,出现了一个必须由CPU立即处理的情况,此时CPU暂时中止程序的执行转而去处理这个新情况的过程就叫中断
    1.硬中断:
        硬件中断是一个异步信号,表明需要注意,或需要改变在执行一个同步事件.硬件中断是由与系统相连的外设(比如网卡 硬盘 键盘等)自动产生的,每个设备或设备集都有自己的IRQ(中断请求)基于IRQ,CPU可以将相应的请求分发到相应的硬件驱动上(注:硬件驱动通常是内核中的一个子程序,而不是一个独立的进程)比如网卡收到一个数据包的时候,就会发出一个中断,处理中断的驱动是需要运行在CPU上的,因此,当中断产生时,CPU会暂时停止当前程序转而执行中断请求,一个中断中能中断一颗CPU(也有一种特殊情况,就是在大型主机上是有硬件通道的,它可以在没有主CPU的支持下,同时处理多个中断),硬件中断可以直接中断CPU,它会引起内核中相关代码被触发,对于那些需要花费时间去处理的进程,中断代码本身也可以被其他硬件中断中断,对于时钟中断,内核调度代码会将当前正在运行的代码挂起,从而让其他代码来运行,它的存在是为了让调度代码(或称为调度器)可以调度多任务

    2.软中断:
        处理类似硬中断,但是软中断仅仅由当前运行进程产生,通常软中断是对一些I/O的请求,软中断仅与内核相联系,而内核主要负责到需要运行的任何其他进程进行调度,软中断不会直接中断CPU,也只有当前正在运行的代码(或进程)才会产生 软中断,软中断是一种需要内核为正在运行的进程去做一些事情(通常为I/O请求),有一个特殊的软中断是Yield调用,它的作用是请求内核调度器去查看是否有一些其他的进程可以运行
    3.硬件中断与软中断的区别:
        1)硬件中断是由外设引发的,软中断是由执行中指令产生的
        2)硬件中断的中断号是由中断控制器提供的,软中断的中断号是由指令直接指出,无需使用中断控制器
        3)硬件中断是可屏蔽的,软中断是不可屏蔽的
        4)硬件中断处理程序要确保它能快速完成任务,这样程序执行时,才不会等待较长时间,称为上半部
        5)软中断处理硬中断未完成的工作,是一个推后执行的机制,属于下半部
